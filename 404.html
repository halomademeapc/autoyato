<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatic Yato Conversation Generator</title>
</head>

<body>
    <div class="container">
        <div class="subject">
            > Someone mentions <span class="templated" data-display="this.subject"></span>.
        </div>
        <div class="chatlog">
            <div class="message" data-show="this.ticks > 1">
                <span class="sender">Yato:</span>
                <span class="content">
                    Imagine <span class="templated" data-display="this.derogatory"></span>
                </span>
            </div>
            <div class="message" data-show="this.ticks > 2">
                <span class="sender">Yato:</span>
                <span class="content">
                    I <span class="templated" data-display="this.alternative"></span>
                </span>
            </div>
            <div class="message" data-show="this.ticks > 3">
                <span class="sender">Yato:</span>
                <span class="content">
                    Anything else is fucking garbage
                </span>
            </div>
        </div>
    </div>

    <script type="application/json" id="sources">
        {
            "windows": {
                "topic": "Windows",
                "derogatory": [
                    "using malware",
                    "using spyware",
                    "using winblows",
                    "having spyware for an operating system"
                ],
                "alternative": [
                    "use linux"
                ]
            },
            "windowsgames": {
                "topic": "Gaming on Windows",
                "derogatory": [
                    "gaming on windows",
                    "playing games on spyware"
                ],
                "alternative": [
                    "run the exact same software but with a bunch of compatibility tools",
                    "think that any games that don't work on Linux just aren't worth playing"
                ]
            },
            "webirc": {
                "topic": "A web-based IRC client",
                "derogatory": [
                    "using chat in a browser",
                    "using webchat",
                    "not using a native app for IRC"
                ],
                "alternative": [
                    "read raw irc traffic with an oscilloscope",
                    "only use native IRC clients even if the interface is shit"
                ]
            },
            "gui": {
                "topic": "Using a GUI",
                "derogatory": [
                    "not doing everything via command line"
                ],
                "alternative": [
                    "keep a Model M keyboard hooked up to my phone at all times for CLI use"
                ]
            }
        }
    </script>
    <script type="text/javascript" src="https://unpkg.com/gravy-bind/dist.browser/index.js"></script>
    <script type="text/javascript">
        class AutoYato {
            topic;
            sources;
            binder;

            subject;
            derogatory;
            alternative;
            ticks;

            initialize = topic => {
                console.info(`Initializing for topic ${topic}`);
                this.binder = new GravyBinder(this);
                this.sources = this.getSources();
                this.topic = topic && this.containsKey(this.sources)
                    ? this.getTopic(topic)
                    : this.getRandomTopic();
                this.setTextFields();
            };

            setTextFields = () => {
                this.subject = this.topic.topic;
                this.derogatory = this.pickArray(this.topic.derogatory);
                this.alternative = this.pickArray(this.topic.alternative);
                this.showFields(969, 4);
            }

            showFields = (delay, max) => {
                this.ticks = 0;
                const interval = window.setInterval(() => {
                    this.ticks++;
                    if (this.ticks >= max) {
                        window.clearInterval(interval);
                    }
                    this.binder.updateOutwardBindings();
                }, delay);
            }

            getRandomTopic = () => this.pickDict(this.sources);

            getTopic = topicName => this.sources[topicName];

            getSources = () => JSON.parse(document.getElementById('sources').innerHTML);

            pickArray = array => array[Math.floor(Math.random() * array.length)];

            pickDict = dictionary => dictionary[this.pickArray(Object.keys(dictionary))];

            containsKey = (dictionary, key) => Object.keys(dictionary).includes(key);
        }

        const ay = new AutoYato();
        ay.initialize(window.location.pathname.toLocaleLowerCase().replace(/\W/g, ''));
    </script>
    <style>
        html {
            background-color: rgb(40, 38, 46);
            color: white;
            font-family: 'Cascadia Code', 'Consolas', monospace;
        }

        .templated {
            color: rgb(255, 178, 78);
        }

        .sender {
            color: #c273ff;
        }

        .container {
            padding: 16px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .message {
            margin: 8px 0 8px 0;
        }
    </style>
</body>

</html>